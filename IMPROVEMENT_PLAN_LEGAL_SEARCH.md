# ๐ฌ ุฎุทุฉ ุชุญุณูู ูุถุน ุงูุจุงุญุซ ุงููุงูููู ุงูุฐูู

## ๐ ุชุญููู ุงููุถุน ุงูุญุงูู

### ููุงุท ุงูููุฉ โ
- **ุจุญุซ ูุฌูู (Hybrid Search)**: ูุฌูุน ุจูู ุงูุจุญุซ ุงูุดุนุงุนู (Vector) ูุงูุจุญุซ ุจุงููููุงุช (BM25).
- **ุฅุนุงุฏุฉ ุชุฑุชูุจ ุฐููุฉ (Reranking)**: ูุณุชุฎุฏู LLM ูุชูููู ูุฏู ุตูุฉ ุงููุชุงุฆุฌ.
- **ูุตุงุฏุฑ ูุชุนุฏุฏุฉ**: ูุนุฑุถ ูุตุงุฏุฑ ุงูุฅุฌุงุจุฉ ููุชุญูู.

### ููุงุท ุงูุถุนู โ๏ธ
| ุงููุดููุฉ | ุงูุชุฃุซูุฑ | ุงูุฃููููุฉ |
|---------|--------|----------|
| **Prompt ูุตูุฑ ุฌุฏุงู** (~100 ูููุฉ) | ุฅุฌุงุจุงุช ุบูุฑ ููุธูุฉ | ๐ด ุนุงููุฉ |
| **BM25 ุชูุณูู ุณุงุฐุฌ** (ูุฑุงุบุงุช ููุท) | ุถุนู ูู ุชุญููู ุงูุนุฑุจูุฉ | ๐ด ุนุงููุฉ |
| **ุฃูุฒุงู RRF ุซุงุจุชุฉ** (0.3 vector / 0.7 BM25) | ุชูุถูู ุงููููุงุช ุนูู ุงููุนูู | ๐ ูุชูุณุทุฉ |
| **ูุง ููุฌุฏ ุชูุณูุน ููุงุณุชุนูุงู** (Query Expansion) | ููุฏุงู ุงููุชุฑุงุฏูุงุช | ๐ ูุชูุณุทุฉ |
| **Reranking ูููู** (ูุณุชุฏุนู LLM) | ุจุทุก + ุงุณุชููุงู API | ๐ข ููุฎูุถุฉ |

---

## ๐๏ธ ุฎุทุฉ ุงูุชุญุณูู

### ุงููุฑุญูุฉ 1: ุชุญุณูู Prompt (ุงูุฃููููุฉ ุงููุตูู) ๐ด

#### [MODIFY] `rag.py` - ุฏุงูุฉ `answer_query`

**ุงูุจุฑููุจุช ุงูุญุงูู (ุถุนูู):**
```
ุฃูุช ุจุงุญุซ ูุงูููู ุฃูุงุฏููู. ุงููุฑุฌุนูุฉ: ุงููุงููู ุงูุฌุฒุงุฆุฑู.
ุชุนูููุงุช:
1. ุฃุฌุจ ุจุฏูุฉ ูุน ุงูุงุณุชุดูุงุฏ ุจุงููุตุงุฏุฑ.
2. ุงูุชูุณูู: ููุฑุงุช ูุงุถุญุฉุ ุงูุชุจุงุณ ุงููุงุฏุฉ "ูุต ุงููุงุฏุฉ" [ุฑูู ุงููุตุฏุฑ].
3. ุฃุถู ูุงุฆูุฉ ุงููุฑุงุฌุน ูู ุงูููุงูุฉ.
```

**ุงูุจุฑููุจุช ุงูููุชุฑุญ (ุงุญุชุฑุงูู):**
```
ุฃูุช **ุจุงุญุซ ูุงูููู ูุชุฎุตุต ูู ุงููุงููู ุงูุฌุฒุงุฆุฑู**ุ ุชุนูู ูู ููุชุจุฉ ูุงููููุฉ ุฃูุงุฏูููุฉ. ูุฑุฌุนูุชู ุงูุญุตุฑูุฉ ูู ุงููุตูุต ุงููุงููููุฉ ุงูููุฏูุฉ ุฃุฏูุงู.

## ูููุชู
ุชุญููู ุงูุณุคุงู ูุชูุฏูู ุฅุฌุงุจุฉ ูุงููููุฉ ุฏูููุฉ ููุจุฑุฑุฉ ุจุงููุตูุต.

## ููุงุนุฏ ุงูุฅุฌุงุจุฉ ุงูุฅูุฒุงููุฉ:
1. **ูุง ุชุฎุชูู ูุนูููุงุช**: ุฅุฐุง ูู ุชุฌุฏ ุงูุฅุฌุงุจุฉ ูู ุงููุตูุต ุงูููุฏูุฉุ ูู ุฐูู ุตุฑุงุญุฉ.
2. **ุงูุงูุชุจุงุณ ุงูุฏููู**: ุนูุฏ ุงูุงุณุชุดูุงุฏ ุจูุงุฏุฉุ ุงูุชุจุณ ูุตูุง ูุงููุงู ุจูู ุนูุงูุงุช ุชูุตูุต.
3. **ุงูุชูุณูู**:
   - ุงุจุฏุฃ ุจู **ููุฎุต ุงูุฅุฌุงุจุฉ** (ุณุทุฑุงู ูุญุฏ ุฃูุตู).
   - ุซู **ุงูุชุญููู ุงูุชูุตููู** ูุน ุฃุฑูุงู ุงููุตุงุฏุฑ [1], [2], ุฅูุฎ.
   - ุงุฎุชู ุจู **ูุงุฆูุฉ ุงููุฑุงุฌุน** (ุงุณู ุงูููู + ุฑูู ุงููุงุฏุฉ ุฅู ูุฌุฏ).
4. **ุงููุบุฉ**: ุงูุนุฑุจูุฉ ุงููุตุญู ุงููุงููููุฉ. ูุง ุชุณุชุฎุฏู ุงูุนุงููุฉ.

## ุงููุตูุต ุงููุชุงุญุฉ:
{context}

## ุงูุณุคุงู:
{query}

## ุงูุฅุฌุงุจุฉ:
```

---

### ุงููุฑุญูุฉ 2: ุชุญุณูู BM25 ููุนุฑุจูุฉ ๐ด

#### [MODIFY] `bm25_service.py` - ุฏุงูุฉ `search`

**ุงููุดููุฉ:**
```python
tokenized_query = query.split(" ")  # ุณุงุฐุฌ ุฌุฏุงู
```

**ุงูุญู:**
```python
import re

def arabic_tokenize(text: str) -> list[str]:
    """Tokenizer ูุชุฎุตุต ููุนุฑุจูุฉ"""
    # 1. ุฅุฒุงูุฉ ุงูุชุดููู
    text = re.sub(r'[\u064B-\u065F]', '', text)
    # 2. ุชุทุจูุน ุงูุฃูู ูุงููุงุก
    text = text.replace('ุฅ', 'ุง').replace('ุฃ', 'ุง').replace('ุข', 'ุง')
    text = text.replace('ู', 'ู').replace('ุฉ', 'ู')
    # 3. ุชูุณูู ุจุงููุฑุงุบุงุช ูุนูุงูุงุช ุงูุชุฑููู
    tokens = re.split(r'[\sุ.ุ:ุ!\-\(\)\[\]]', text)
    # 4. ุฅุฒุงูุฉ ุงููุงุฑุบุฉ ูุงููุตูุฑุฉ
    return [t for t in tokens if len(t) > 1]
```

---

### ุงููุฑุญูุฉ 3: ุชุญุณูู ุฃูุฒุงู RRF ๐

#### [MODIFY] `rag.py` - ุฏุงูุฉ `_retrieve`

**ุงููุถุน ุงูุญุงูู:**
```python
scores[d] = scores.get(d, 0) + (0.3 / (k + r + 1))  # Vector
scores[d] = scores.get(d, 0) + (0.7 / (k + r + 1))  # BM25
```

**ุงูููุชุฑุญ (ุชูุงุฒู ุฃูุถู):**
```python
scores[d] = scores.get(d, 0) + (0.5 / (k + r + 1))  # Vector
scores[d] = scores.get(d, 0) + (0.5 / (k + r + 1))  # BM25
```

> **ุงูุณุจุจ:** ุงููุงููู ูุญุชุงุฌ ููุจุญุซ ุงูุฏูุงูู (ุงููุนูู) ุจููุณ ูุฏุฑ ุงููููุงุช ุงููุญุฏุฏุฉ.

---

### ุงููุฑุญูุฉ 4: (ุงุฎุชูุงุฑู) ุชูุณูุน ุงูุงุณุชุนูุงู ๐

ุฅุถุงูุฉ ูุชุฑุงุฏูุงุช ูุงููููุฉ ุดุงุฆุนุฉ:
```python
LEGAL_SYNONYMS = {
    "ุนููุจุฉ": ["ุฌุฒุงุก", "ุนูุงุจ", "ุฌุฑููุฉ"],
    "ููุฑุงุซ": ["ุชุฑูุฉ", "ุฅุฑุซ", "ูุฑุงุซุฉ"],
    "ุนูุฏ": ["ุงุชูุงู", "ุงุชูุงููุฉ", "ุงูุชุฒุงู"],
    # ...
}
```

---

## ๐ ุฎุทุฉ ุงูุงุฎุชุจุงุฑ

### ุฃุณุฆูุฉ ุงูุงุฎุชุจุงุฑ (10 ุฃุณุฆูุฉ ูุชููุนุฉ)
1. ูุง ูู ุนููุจุฉ ุงูุณุฑูุฉ ุงูููุตููุฉ ูู ุงููุงููู ุงูุฌุฒุงุฆุฑูุ
2. ูุง ูู ุดุฑูุท ุตุญุฉ ุนูุฏ ุงูุฒูุงุฌุ
3. ููู ูุชู ุชูุฒูุน ุงูููุฑุงุซ ุจูู ุงููุฑุซุฉุ
4. ูุง ูู ุญููู ุงูุนุงูู ูู ุญุงูุฉ ุงููุตู ุงูุชุนุณููุ
5. ูุง ูู ุฅุฌุฑุงุกุงุช ุงูุทุนู ุจุงูููุถ ุฃูุงู ุงููุญููุฉ ุงูุนููุงุ
6. ูุง ูู ุนููุจุฉ ุฌุฑููุฉ ุงูุชุฒููุฑุ
7. ูุง ูู ุดุฑูุท ุงูุญุตูู ุนูู ุงูุฌูุณูุฉ ุงูุฌุฒุงุฆุฑูุฉุ
8. ูุง ูู ุญููู ุงููุณุชุฃุฌุฑ ูู ุนูุฏ ุงูุฅูุฌุงุฑุ
9. ูุง ูู ุฅุฌุฑุงุกุงุช ุฑูุน ุฏุนูู ุงูุทูุงูุ
10. ูุง ูู ุณู ุงูุฑุดุฏ ุงููุงูููู ูู ุงูุฌุฒุงุฆุฑุ

### ูุนุงููุฑ ุงูุชูููู
| ุงููุนูุงุฑ | ุงููุตู | ุงูุฏุฑุฌุฉ |
|---------|------|-------|
| **ุงูุฏูุฉ** | ูู ุงูุฅุฌุงุจุฉ ุตุญูุญุฉ ูุงููููุงูุ | /10 |
| **ุงูุงุณุชุดูุงุฏ** | ูู ุงููุตุงุฏุฑ ุตุญูุญุฉ ููุฐููุฑุฉุ | /10 |
| **ุงูุดููููุฉ** | ูู ุบุทุช ุฌููุน ุฌูุงูุจ ุงูุณุคุงูุ | /10 |
| **ุงููุถูุญ** | ูู ุงูุตูุงุบุฉ ูุงุถุญุฉ ูููุธูุฉุ | /10 |

---

## โฑ๏ธ ุงูุฌุฏูู ุงูุฒููู ุงูููุชุฑุญ

| ุงููุฑุญูุฉ | ุงูููุช | ุงูุฃููููุฉ |
|---------|------|----------|
| ุชุญุณูู Prompt | 30 ุฏูููุฉ | ๐ด |
| ุชุญุณูู BM25 | 20 ุฏูููุฉ | ๐ด |
| ุถุจุท ุฃูุฒุงู RRF | 5 ุฏูุงุฆู | ๐ |
| ุงุฎุชุจุงุฑ 10 ุฃุณุฆูุฉ | 60 ุฏูููุฉ | ๐ด |

---

## โ ุงูููุงููุฉ ุงููุทููุจุฉ
ูู ุชูุงูู ุนูู ูุฐู ุงูุฎุทุฉุ ูููููู ุงูุจุฏุก ุจุงููุฑุญูุฉ ุงูุฃููู (ุชุญุณูู Prompt) ููุฑุงู.
